
document.addEventListener("DOMContentLoaded", () => {
    	 const main = document.querySelector("main");
const resultEl = document.getElementById("result");    // const lastAttemptKey = getLastAttemptKey(); // ‚úÖ –û—Ç—Ä–∏–º—É—î–º–æ –∫–ª—é—á –¥–ª—è LocalStorage
    // const lastAttempt = localStorage.getItem(lastAttemptKey); // ‚úÖ –û–≥–æ–ª–æ—à—É—î–º–æ lastAttempt
    // const lastAttemptDate = lastAttempt ? new Date(lastAttempt) : null;
   const header = document.querySelector("header");
    	// const bodyContent = document.querySelector("body");
    	 const footer = document.querySelector("footer");
 const startBtn = document.getElementById("start-btn");
window.sendResultsBtn = document.getElementById("send-results-btn");
    // –í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –æ–±–º–µ–∂–µ–Ω—å
   // if (!checkTestRetry(main)) {
       // console.log("‚ùå –í–∏ –≤–∂–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Ç–µ—Å—Ç. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–æ.");
       //  return; –ó—É–ø–∏–Ω—è—î–º–æ –ø–æ–¥–∞–ª—å—à–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —è–∫—â–æ —Ç–µ—Å—Ç –≤–∂–µ –±—É–≤ –ø—Ä–æ–π–¥–µ–Ω–∏–π
    //}
 const taskContainer = document.getElementById("task-container-raven");
  const timerEl = document.getElementById("timer");
  let currentTaskIndex = 0;
  let score = 0;//  let score;
  let timerInterval;
      window.calculateLevel = function(score) {
    if (score === 10) return "–î—É–∂–µ –≤–∏—Å–æ–∫–∏–π";
    if (score >= 8) return "–í–∏—Å–æ–∫–∏–π";
    if (score >= 4) return "–°–µ—Ä–µ–¥–Ω—ñ–π";
    if (score >= 2) return "–ù–∏–∑—å–∫–∏–π";
    return "–î—É–∂–µ –Ω–∏–∑—å–∫–∏–π";
};
const tasks = [
    {
        image: "img/matrytsya_ravena/matrytsya_ravena1.jpg",
        options: [
            "img/matrytsya_ravena/matrytsya_ravena1_1.png",
            "img/matrytsya_ravena/matrytsya_ravena1_2.png",
            "img/matrytsya_ravena/matrytsya_ravena1_3.png",
            "img/matrytsya_ravena/matrytsya_ravena1_4.png",
            "img/matrytsya_ravena/matrytsya_ravena1_5.png",
            "img/matrytsya_ravena/matrytsya_ravena1_6.png",
            "img/matrytsya_ravena/matrytsya_ravena1_7.png",
            "img/matrytsya_ravena/matrytsya_ravena1_8.png"
        ],
        correct: 7
    },
    {
        image: "img/matrytsya_ravena/matrytsya_ravena2.jpg",
        options: [
            "img/matrytsya_ravena/matrytsya_ravena2_1.png",
            "img/matrytsya_ravena/matrytsya_ravena2_2.png",
            "img/matrytsya_ravena/matrytsya_ravena2_3.png",
            "img/matrytsya_ravena/matrytsya_ravena2_4.png",
            "img/matrytsya_ravena/matrytsya_ravena2_5.png",
            "img/matrytsya_ravena/matrytsya_ravena2_6.png",
            "img/matrytsya_ravena/matrytsya_ravena2_7.png",
            "img/matrytsya_ravena/matrytsya_ravena2_8.png"
        ],
        correct: 6
    },
    {
        image: "img/matrytsya_ravena/matrytsya_ravena3.jpg",
        options: [
            "img/matrytsya_ravena/matrytsya_ravena3_1.png",
            "img/matrytsya_ravena/matrytsya_ravena3_2.png",
            "img/matrytsya_ravena/matrytsya_ravena3_3.png",
            "img/matrytsya_ravena/matrytsya_ravena3_4.png",
            "img/matrytsya_ravena/matrytsya_ravena3_5.png",
            "img/matrytsya_ravena/matrytsya_ravena3_6.png",
            "img/matrytsya_ravena/matrytsya_ravena3_7.png",
            "img/matrytsya_ravena/matrytsya_ravena3_8.png"
        ],
        correct: 6
    }
,
    {
         image: "img/matrytsya_ravena/matrytsya_ravena4.jpg",
        options: [
            "img/matrytsya_ravena/matrytsya_ravena4_1.png",
            "img/matrytsya_ravena/matrytsya_ravena4_2.png",
            "img/matrytsya_ravena/matrytsya_ravena4_3.png",
            "img/matrytsya_ravena/matrytsya_ravena4_4.png",
            "img/matrytsya_ravena/matrytsya_ravena4_5.png",
            "img/matrytsya_ravena/matrytsya_ravena4_6.png",
            "img/matrytsya_ravena/matrytsya_ravena4_7.png",
            "img/matrytsya_ravena/matrytsya_ravena4_8.png"
        ], correct: 1 },
    { image: "img/matrytsya_ravena/matrytsya_ravena5.jpg",
        options: [
            "img/matrytsya_ravena/matrytsya_ravena5_1.png",
            "img/matrytsya_ravena/matrytsya_ravena5_2.png",
            "img/matrytsya_ravena/matrytsya_ravena5_3.png",
            "img/matrytsya_ravena/matrytsya_ravena5_4.png",
            "img/matrytsya_ravena/matrytsya_ravena5_5.png",
            "img/matrytsya_ravena/matrytsya_ravena5_6.png",
            "img/matrytsya_ravena/matrytsya_ravena5_7.png",
            "img/matrytsya_ravena/matrytsya_ravena5_8.png"
        ], correct: 2 },
    { image: "img/matrytsya_ravena/matrytsya_ravena6.jpg",
        options: [
            "img/matrytsya_ravena/matrytsya_ravena6_1.png",
            "img/matrytsya_ravena/matrytsya_ravena6_2.png",
            "img/matrytsya_ravena/matrytsya_ravena6_3.png",
            "img/matrytsya_ravena/matrytsya_ravena6_4.png",
            "img/matrytsya_ravena/matrytsya_ravena6_5.png",
            "img/matrytsya_ravena/matrytsya_ravena6_6.png",
            "img/matrytsya_ravena/matrytsya_ravena6_7.png",
            "img/matrytsya_ravena/matrytsya_ravena6_8.png"
        ], correct: 5 },
    { image: "img/matrytsya_ravena/matrytsya_ravena7.jpg",
        options: [
            "img/matrytsya_ravena/matrytsya_ravena7_1.png",
            "img/matrytsya_ravena/matrytsya_ravena7_2.png",
            "img/matrytsya_ravena/matrytsya_ravena7_3.png",
            "img/matrytsya_ravena/matrytsya_ravena7_4.png",
            "img/matrytsya_ravena/matrytsya_ravena7_5.png",
            "img/matrytsya_ravena/matrytsya_ravena7_6.png",
            "img/matrytsya_ravena/matrytsya_ravena7_7.png",
            "img/matrytsya_ravena/matrytsya_ravena7_8.png"
        ], correct: 6 },
    { image: "img/matrytsya_ravena/matrytsya_ravena8.jpg",
        options: [
            "img/matrytsya_ravena/matrytsya_ravena8_1.png",
            "img/matrytsya_ravena/matrytsya_ravena8_2.png",
            "img/matrytsya_ravena/matrytsya_ravena8_3.png",
            "img/matrytsya_ravena/matrytsya_ravena8_4.png",
            "img/matrytsya_ravena/matrytsya_ravena8_5.png",
            "img/matrytsya_ravena/matrytsya_ravena8_6.png",
            "img/matrytsya_ravena/matrytsya_ravena8_7.png",
            "img/matrytsya_ravena/matrytsya_ravena8_8.png"
        ], correct: 1 },
    { image: "img/matrytsya_ravena/matrytsya_ravena9.jpg",
        options: [
            "img/matrytsya_ravena/matrytsya_ravena9_1.png",
            "img/matrytsya_ravena/matrytsya_ravena9_2.png",
            "img/matrytsya_ravena/matrytsya_ravena9_3.png",
            "img/matrytsya_ravena/matrytsya_ravena9_4.png",
            "img/matrytsya_ravena/matrytsya_ravena9_5.png",
            "img/matrytsya_ravena/matrytsya_ravena9_6.png",
            "img/matrytsya_ravena/matrytsya_ravena9_7.png",
            "img/matrytsya_ravena/matrytsya_ravena9_8.png"
        ], correct: 3 },
    { image: "img/matrytsya_ravena/matrytsya_ravena10.jpg",
        options: [
            "img/matrytsya_ravena/matrytsya_ravena10_1.png",
            "img/matrytsya_ravena/matrytsya_ravena10_2.png",
            "img/matrytsya_ravena/matrytsya_ravena10_3.png",
            "img/matrytsya_ravena/matrytsya_ravena10_4.png",
            "img/matrytsya_ravena/matrytsya_ravena10_5.png",
            "img/matrytsya_ravena/matrytsya_ravena10_6.png",
            "img/matrytsya_ravena/matrytsya_ravena10_7.png",
            "img/matrytsya_ravena/matrytsya_ravena10_8.png"
        ], correct: 5 }

];//tasks











	
  // ‚úÖ –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ—ó –ü–Ü–°–õ–Ø –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó
  startBtn.addEventListener("click", startTest);

  function startTest() {
    console.log("üîπ startTest() –∑–∞–ø—É—â–µ–Ω–æ!");
    currentTaskIndex = 0;
    score = 0;
    taskContainer.style.display = "flex";
    startBtn.style.display = "none";
    sendResultsBtn.style.display = "none";
    startTimer(600);
    loadTask();
  }

  function startTimer(duration) {
    let timeLeft = duration;

    timerInterval = setInterval(() => {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      timerEl.textContent = `‚è≥ ${minutes}:${seconds < 10 ? "0" : ""}${seconds}`;
      timeLeft--;

      if (timeLeft < 0) {
        clearInterval(timerInterval);
        finishTest();
      }
    }, 1000);
  }

function loadTask() {
    const task = tasks[currentTaskIndex];

    taskContainer.innerHTML = `
        <div class="task-content">
            <img src="${task.image}" class="main-image">
            <div class="answer-options">
                <button id="next-btn" disabled>–î–∞–ª—ñ</button>
                <div class="options">
                    ${task.options.map((imgSrc, index) => `
                        <img class="option" src="${imgSrc}" data-index="${index + 1}">
                    `).join('')}
                </div>
            </div>
        </div>
    `;
    // –û—Ç—Ä–∏–º—É—î–º–æ –≤—Å—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
    const options = document.querySelectorAll(".option");
    let selectedOption = null;
taskContainer.classList.add("container-active");
header.classList.add("low-opacity"); 
footer.classList.add("container-color");
main.classList.add("container-color");
    options.forEach(option => {
        option.addEventListener("click", () => {
            // –ó–Ω—ñ–º–∞—î–º–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –∑ —É—Å—ñ—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
            options.forEach(opt => opt.classList.remove("selected"));

            // –í–∏–¥—ñ–ª—è—î–º–æ –æ–±—Ä–∞–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç
            option.classList.add("selected");
            selectedOption = option.getAttribute("data-index");
            // –ê–∫—Ç–∏–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É "–î–∞–ª—ñ"
            document.getElementById("next-btn").disabled = false;
        });
    });

    // –î–æ–¥–∞—î–º–æ –ø–æ–¥—ñ—é –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–î–∞–ª—ñ"
    document.getElementById("next-btn").addEventListener("click", () => {
        if (selectedOption !== null) {
            checkAnswer(selectedOption);
        }
    });
}


//‚úÖ checkAnswer
function checkAnswer(selectedOption) {
    // –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ selectedOption —É —á–∏—Å–ª–æ
    const userAnswer = parseInt(selectedOption);
    
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –≤–∞—Ä—ñ–∞–Ω—Ç—É
    if (userAnswer === tasks[currentTaskIndex].correct) {
        score++;
    }

    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è
    currentTaskIndex++;

    if (currentTaskIndex < tasks.length) {
        loadTask();
    } else {
        finishTest();
    }

    console.log("‚úÖ –ü—ñ–¥—Ä–∞—Ö–æ–≤–∞–Ω–∏–π –±–∞–ª:", score);
}
//‚úÖ checkAnswer let
/*window.calculateScore = function () {
    
    const answers = document.querySelectorAll('input[type="radio"]:checked');

    answers.forEach((input) => {
        if (input.value === "1") score++; // –ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, —â–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –º–∞—é—Ç—å value="1"
    });
};*/

 //üèÅüèÅüèÅüèÅüèÅüèÅüèÅüèÅüèÅüèÅüèÅüèÅüèÅfinishTest
  function finishTest() {
header.classList.remove("low-opacity"); 
         taskContainer.classList.remove("container-active");

footer.classList.remove("container-color");
main.classList.remove("container-color"); 

    clearInterval(timerInterval);
    resultEl.innerHTML = "üõë –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç'.";
    taskContainer.innerHTML = "";
    sendResultsBtn.style.display = "block";
  }//üèÅfinishTest


// üè´üßíüìõ –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø–∏—Ç—É —ñ–º–µ–Ω—ñ —Å—Ç—É–¥–µ–Ω—Ç–∞
window.askStudentName = function () {
    let studentName = prompt("–í–≤–µ–¥—ñ—Ç—å –≤–∞—à—ñ —ñ–º'—è —Ç–∞ –ø–µ—Ä—à—É –ª—ñ—Ç–µ—Ä—É –ø—Ä—ñ–∑–≤–∏—â–∞:").trim();

    if (!studentName || studentName.length < 2) {
        alert("‚ùó –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —ñ–º'—è, –±—ñ–ª—å—à–µ –∑–∞ 1 —Å–∏–º–≤–æ–ª.");
        return null;  // ‚ùå –Ø–∫—â–æ —ñ–º'—è –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ, –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ null
    }

    // ‚úÖ –§—ñ–ª—å—Ç—Ä —Å–∏–º–≤–æ–ª—ñ–≤ —É —ñ–º–µ–Ω—ñ
    let cleanedStudentName = studentName.replace(/[^a-zA-Z–ê-–Ø–∞-—è–á—ó–Ü—ñ–Ñ—î“ê“ë0-9.' ]/g, "");

    return cleanedStudentName;  // ‚úÖ –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –æ—á–∏—â–µ–Ω–µ —ñ–º'—è
};// üè´üßíüìõ –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø–∏—Ç—É —ñ–º–µ–Ω—ñ —Å—Ç—É–¥–µ–Ω—Ç–∞

  
window.getEntryIDs = function () {
    
 
        
        return {
            formURL: "https://docs.google.com/forms/u/0/d/e/1FAIpQLSfyylO6_4cpbzuD6THcT95VMAW5R7Foy1qykWDloI7Rew2b1g/formResponse",
            name: "entry.511676966",
            score: "entry.1008291282",
            level: "entry.1332224844"
        }
      
        return null;

  };//getEntryIDs




  /* if (startBtn) {
        startBtn.addEventListener("click", () => {
            console.log("‚úÖ –ü–æ—á–∞—Ç–æ–∫ —Ç–µ—Å—Ç—É: –ú–∞—Ç—Ä–∏—Ü—è –†–∞–≤–µ–Ω–∞");
            startTest();
        });
    } else {
        console.error("‚ùå start-btn –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!");
    }*/


    sendResultsBtn.addEventListener("click", () => submitResults());
    });// DOMContentLoaded

window.submitResults = function(finalScore, level, entryIDs, sendStudentName) {
    console.log("üì® submitResults() –∑–∞–ø—É—â–µ–Ω–æ!");
    entryIDs = getEntryIDs();
    if (!entryIDs) {
        console.error(`‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ entry ID –¥–ª—è —Ç–µ—Å—Ç—É: ${testType}`);
        return;
    }
    if (window.isSubmitting) return;
    window.isSubmitting = true;

    console.log("‚úÖ –§—É–Ω–∫—Ü—ñ—è submitResults –≤–∏–∫–ª–∏–∫–∞–Ω–∞!");

    if (!entryIDs || !entryIDs.formURL) {
        console.error("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ entry ID –¥–ª—è —Ü—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏.");
        alert("‚ùå –ü–æ–º–∏–ª–∫–∞! –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ entry ID.");
        window.isSubmitting = false;
        return;
    }

    console.log("üîπ –û—Ç—Ä–∏–º–∞–Ω—ñ entry IDs:", entryIDs);
    console.log("‚úÖ –í–∏–∑–Ω–∞—á–µ–Ω—ñ entry IDs:", entryIDs);
    
    level = calculateLevel(score);  // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≥–ª–æ–±–∞–ª—å–Ω—É –∑–º—ñ–Ω–Ω—É score
    sendStudentName = askStudentName();
    console.log("‚úÖ –Ü–º'—è —Å—Ç—É–¥–µ–Ω—Ç–∞:", sendStudentName);
    console.log("‚úÖ –í–∏–∑–Ω–∞—á–µ–Ω—ñ entry IDs:", entryIDs);
    console.log("‚úÖ –û–±—á–∏—Å–ª–µ–Ω–∏–π –±–∞–ª:", score);
    console.log("‚úÖ –í–∏–∑–Ω–∞—á–µ–Ω–∏–π —Ä—ñ–≤–µ–Ω—å:", level);

    if (!sendStudentName) {
        console.error("‚ùå askStudentName() –ø–æ–≤–µ—Ä–Ω—É–ª–∞ `null`. –í–∏–∫–æ–Ω–∞–Ω–Ω—è –∑—É–ø–∏–Ω–µ–Ω–æ.");
        return;
    }
    if (isNaN(score) || !level) {
        console.error("‚ùå finalScore –∞–±–æ level –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ!");
        return;
    }

    const formData = new URLSearchParams();
    formData.append(entryIDs.name, sendStudentName);
    formData.append(entryIDs.score, Number(score));
    formData.append(entryIDs.level, String(level));

    console.log("üîπ –ù–∞–¥—Å–∏–ª–∞—î–º–æ:", Object.fromEntries(formData));
    console.log("üì© –§–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–¥ –≤—ñ–¥–ø—Ä–∞–≤–∫–æ—é:", formData.toString());

    fetch(entryIDs.formURL, {
        method: "POST",
        mode: "no-cors", 
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: formData
    })
    .then(() => {
        console.log("‚úÖ –£—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!");
        alert("‚úÖ –î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω—ñ —É Google Forms!");
        document.getElementById("send-results-btn").style.display = "none";
        resultEl.innerHTML = `<strong>–î—è–∫—É—î–º–æ –∑–∞ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è!</strong>`;
          // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞—Ç—É –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Å–ø—Ä–æ–±–∏ –≤ localStorage
        //localStorage.setItem(getLastAttemptKey(), new Date().toISOString());
        //console.log("‚úÖ –î–∞—Ç–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Å–ø—Ä–æ–±–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–∞:", new Date().toISOString());
    })
    .catch(error => {
        console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è:", error);
        alert("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏. –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
    })
    .finally(() => {
        window.isSubmitting = false;
    });
};// ‚úÖ –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É Google Forms






